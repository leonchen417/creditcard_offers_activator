javascript:(()=>{const A=location.hostname,B=location.pathname,C=location.href,D=/(^|\.)americanexpress\.com$|(^|\.)aexp\.com$/i.test(A)&&/\/offers(\/|$)/i.test(B),E=/(^|\.)citi\.com$/i.test(A)&&/\/merchantoffers(\/|$)/i.test(B),F=/(^|\.)chase\.com$/i.test(A)&&/merchantOffers/i.test(C);if(!(D||E||F)){alert("❌ Amex/Citi/Chase OFFER pages only.");return}if(window.__OFX&&window.__OFX.active){alert("Learner already running.");return}const G=H=>new Promise(I=>setTimeout(I,H)),J=K=>{try{const L=K.getBoundingClientRect(),M=getComputedStyle(K);return L.width>0&&L.height>0&&"hidden"!==M.visibility&&"none"!==M.display}catch{return!1}},N=O=>(((O?.innerText??"")||(O?.textContent??""))+"").trim(),P=Q=>(Q||"").toLowerCase(),R=S=>S.closest("button,[role='button'],a[href],[tabindex]:not([tabindex='-1'])")||S,T=U=>{let V=U,W=0;for(;V&&W++<3;){const X=P(N(V));if(/(add|activate|enroll|save|card|offer)/i.test(X))return X;for(const Y of V.children){if(Y===U)continue;const Z=P(N(Y));if(/(add|activate|enroll|save|card|offer)/i.test(Z))return Z}V=V.parentElement}return""},aa=ab=>new Set(String(ab.className||"").split(/\s+/).filter(Boolean)),ac=ad=>ad.getAttribute?.("aria-label")||ad.getAttribute?.("title")||"",ae=af=>{const ag=C,ah=ai=>{const aj=ai.target&&ai.target.closest&&ai.target.closest("a,[role='link'],[href]");aj&&(ai.preventDefault(),ai.stopPropagation())},ak=history.pushState,al=history.replaceState;history.pushState=function(){},history.replaceState=function(){};const am=()=>{/merchantOffers\/offer-activated/i.test(location.href)&&(location.hash=ag.split("#")[1]||"")};return window.addEventListener("hashchange",am,!0),document.addEventListener("click",ah,!0),Promise.resolve(af()).finally(()=>{document.removeEventListener("click",ah,!0),window.removeEventListener("hashchange",am,!0),history.pushState=ak,history.replaceState=al})},an=()=>{const ao="[aria-label*='Add'],[aria-label*='Activate'],[aria-label*='Enroll'],button[aria-label],[role='button'][aria-label]";return[...document.querySelectorAll(ao)].filter(ap=>/add|activate|enroll/i.test(ac(ap)||""))},aq=ar=>{const as=[...new Set(ar.map(at=>at.tagName.toLowerCase()))];ar.map(au=>au.getAttribute&&au.getAttribute("role")).find(Boolean);let av=null;for(const aw of ar){const ax=aa(aw);av=av?new Set([...av].filter(ay=>ax.has(ay))):ax}av=av?new Set([...av].filter(az=>az.length>2)):new Set;const aA=ar.map(aB=>P(ac(aB)||N(aB)||T(aB))).filter(Boolean),aC=/add|activate|enroll|save/,aD=aA.some(aE=>aC.test(aE)),aF=aD?aC:null;let aG=1===as.length?as[0]:"button,[role='button']";return av.size&&(aG+="."+[...av].slice(0,3).join(".")),function(aH){if(!J(aH))return!1;const aI=R(aH);if(aI!==aH)return!1;if("button,[role='button']"!==aG){if(!aH.matches(aG))return!1}else if(!(aH.matches("button,[role='button']")||"a"===aH.tagName.toLowerCase()))return!1;const aJ=P(ac(aH)||N(aH)||T(aH));return aF?aF.test(aJ):aC.test(aJ)||aJ.includes("card")||aJ.includes("offer")}},aK=aL=>{let aM=[...document.querySelectorAll("button,[role='button'],a,[tabindex]")];if(F){const aN=an();aN.length&&(aM=aN)}const aO=[],aP=new Set;for(const aQ of aM){const aR=R(aQ);if(aP.has(aR))continue;aP.add(aR);if(aL(aR))aO.push(aR)}return aO.filter(J)},aS=(aT,aU)=>{try{aT.style.outline=`3px solid ${aU}`}catch{}},aV=()=>{const aW=document.createElement("style");aW.setAttribute("data-ofx-print","1"),aW.media="print",aW.textContent="@page{margin:12mm;}*{-webkit-print-color-adjust:exact;print-color-adjust:exact;}a[href]:after{content:\"\";}",document.head.appendChild(aW)},aX=()=>{const aY=document.querySelectorAll("*");for(const aZ of aY){aZ.style.setProperty("text-overflow","clip","important"),aZ.style.setProperty("overflow","visible","important"),aZ.style.setProperty("white-space","normal","important"),aZ.style.setProperty("-webkit-line-clamp","unset","important"),aZ.style.setProperty("line-clamp","unset","important");"-webkit-box"===getComputedStyle(aZ).display&&aZ.style.setProperty("display","block","important")}document.querySelectorAll("details:not([open])").forEach(a0=>a0.setAttribute("open",""));document.querySelectorAll("img[loading]").forEach(a1=>a1.loading="eager")},a2=()=>{const a3=navigator.platform.toLowerCase().includes("mac")?"⌘P":"Ctrl+P",a4=document.createElement("div");a4.setAttribute("data-ofx-banner","1"),a4.style.cssText="position:fixed;inset:12px 12px auto 12px;z-index:2147483647;background:#111;color:#fff;padding:10px 14px;border-radius:8px;font:14px/1.3 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;box-shadow:0 6px 20px rgba(0,0,0,.3);",a4.innerHTML=`<strong>Page prepared for PDF.</strong><div style="opacity:.9;margin-top:4px">Use <b>${a3}</b> or your browser menu to open <b>Print</b>, then “Save as PDF”.</div><button type="button" style="margin-top:8px;background:#2e7d32;color:#fff;border:0;padding:6px 10px;border-radius:6px;cursor:pointer;">OK</button>`,a4.querySelector("button").onclick=()=>a4.remove(),document.body.appendChild(a4)},a5=async()=>{aV(),aX(),await new Promise(a6=>setTimeout(a6,100)),a2()},a7=async a8=>{const a9=async()=>{for(const ba of a8){ba.scrollIntoView({block:"center"}),aS(ba,"#2196f3"),await G(300+Math.random()*700);try{ba.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0})),aS(ba,"#4caf50"),await G(700+Math.random()*700)}catch{aS(ba,"red")}}};F?await ae(a9):await a9(),await a5()};const a_= {samples:[],matcher:null,active:!0};window.__OFX=a_,alert("LEARN MODE: Click 2–3 real ACTIVATE buttons. Press ESC when done to preview.");const b0=b1=>{const b2=R(b1.target);b2&&(a_.samples.push(b2),aS(b2,"orange"),b1.preventDefault(),b1.stopPropagation())},b3=b4=>{if("Escape"===b4.key){document.removeEventListener("click",b0,!0),document.removeEventListener("keydown",b3,!0);if(a_.samples.length<1){alert("No samples captured."),a_.active=!1;return}a_.matcher=aq(a_.samples);const b5=aK(a_.matcher);if(b5.forEach(b6=>aS(b6,"orange")),!b5.length){alert("No matches found. Try selecting other samples."),a_.active=!1;return}confirm(`Preview: found ${b5.length} buttons. Click OK to activate them.`)?a7(b5).finally(()=>a_.active=!1):(a_.active=!1,alert("Cancelled. (Outlines remain for reference.)"))}};document.addEventListener("click",b0,!0),document.addEventListener("keydown",b3,!0)})();
