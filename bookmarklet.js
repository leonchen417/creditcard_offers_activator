javascript:(()=>{const a=location.hostname,b=location.pathname,c=location.href,d=/(^|\.)americanexpress\.com$|(^|\.)aexp\.com$/i.test(a)&&/\/offers(\/|$)/i.test(b),e=/(^|\.)citi\.com$/i.test(a)&&/\/merchantoffers(\/|$)/i.test(b),f=/(^|\.)chase\.com$/i.test(a)&&/merchantOffers/i.test(c);if(!(d||e||f)){alert("❌ Amex/Citi/Chase OFFER pages only.");return}if(window.__OFX&&window.__OFX.active){alert("Learner already running.");return}const g=h=>new Promise(i=>setTimeout(i,h)),j=k=>{try{const l=k.getBoundingClientRect(),m=getComputedStyle(k);return l.width>0&&l.height>0&&"hidden"!==m.visibility&&"none"!==m.display}catch{return!1}},n=o=>(((o?.innerText??"")||(o?.textContent??""))+"").trim(),p=q=>(q||"").toLowerCase(),r=s=>s.closest("button,[role='button'],a[href],[tabindex]:not([tabindex='-1'])")||s,t=u=>{let v=u,w=0;for(;v&&w++<3;){const x=p(n(v));if(/(add|activate|enroll|save|card|offer)/i.test(x))return x;for(const y of v.children){if(y===u)continue;const z=p(n(y));if(/(add|activate|enroll|save|card|offer)/i.test(z))return z}v=v.parentElement}return""},A=B=>new Set(String(B.className||"").split(/\s+/).filter(Boolean)),C=D=>D.getAttribute?.("aria-label")||D.getAttribute?.("title")||"",E=F=>{const G=c,H=I=>{const J=I.target&&I.target.closest&&I.target.closest("a,[role='link'],[href]");J&&(I.preventDefault(),I.stopPropagation())},K=history.pushState,L=history.replaceState;history.pushState=function(){},history.replaceState=function(){};const M=()=>{/merchantOffers\/offer-activated/i.test(location.href)&&(location.hash=G.split("#")[1]||"")};return window.addEventListener("hashchange",M,!0),document.addEventListener("click",H,!0),Promise.resolve(F()).finally(()=>{document.removeEventListener("click",H,!0),window.removeEventListener("hashchange",M,!0),history.pushState=K,history.replaceState=L})},N=()=>{const O="[aria-label*='Add'],[aria-label*='Activate'],[aria-label*='Enroll'],button[aria-label],[role='button'][aria-label]";return[...document.querySelectorAll(O)].filter(P=>/add|activate|enroll/i.test(C(P)||""))},Q=R=>{const S=[...new Set(R.map(T=>T.tagName.toLowerCase()))];R.map(U=>U.getAttribute&&U.getAttribute("role")).find(Boolean);let V=null;for(const W of R){const X=A(W);V=V?new Set([...V].filter(Y=>X.has(Y))):X}V=V?new Set([...V].filter(Z=>Z.length>2)):new Set;const $=R.map(_=>p(C(_)||n(_)||t(_))).filter(Boolean),aa=/add|activate|enroll|save/,ab=$.some(ac=>aa.test(ac)),ad=ab?aa:null;let ae=1===S.length?S[0]:"button,[role='button']";return V.size&&(ae+="."+[...V].slice(0,3).join(".")),function(af){if(!j(af))return!1;const ag=r(af);if(ag!==af)return!1;if("button,[role='button']"!==ae){if(!af.matches(ae))return!1}else if(!(af.matches("button,[role='button']")||"a"===af.tagName.toLowerCase()))return!1;const ah=p(C(af)||n(af)||t(af));return ad?ad.test(ah):aa.test(ah)||ah.includes("card")||ah.includes("offer")}},ai=aj=>{let ak=[...document.querySelectorAll("button,[role='button'],a,[tabindex]")];if(f){const al=N();al.length&&(ak=al)}const am=[],an=new Set;for(const ao of ak){const ap=r(ao);if(an.has(ap))continue;an.add(ap);if(aj(ap))am.push(ap)}return am.filter(j)},aq=(ar,as)=>{try{ar.style.outline=`3px solid ${as}`}catch{}},at=async au=>{let av=0,aw=0;await E(async()=>{for(const ax of au){ax.scrollIntoView({block:"center"}),aq(ax,"#2196f3"),await g(300+Math.random()*700);try{ax.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0})),aq(ax,"#4caf50"),av++,await g(700+Math.random()*700)}catch{aq(ax,"red"),aw++}}}),alert(`✅ Clicked: ${av} • ❌ Errors: ${aw}`)};const ay={samples:[],matcher:null,active:!0};window.__OFX=ay,alert("LEARN MODE: Click 2–3 real ACTIVATE buttons. Press ESC when done to preview.");const az=aA=>{const aB=r(aA.target);aB&&(ay.samples.push(aB),aq(aB,"orange"),aA.preventDefault(),aA.stopPropagation())},aC=aD=>{if("Escape"===aD.key){document.removeEventListener("click",az,!0),document.removeEventListener("keydown",aC,!0);if(ay.samples.length<1){alert("No samples captured."),ay.active=!1;return}ay.matcher=Q(ay.samples);const aE=ai(ay.matcher);if(aE.forEach(aF=>aq(aF,"orange")),!aE.length){alert("No matches found. Try selecting other samples."),ay.active=!1;return}confirm(`Preview: found ${aE.length} buttons. Click OK to activate them.`)?at(aE).finally(()=>ay.active=!1):(ay.active=!1,alert("Cancelled. (Outlines remain for reference.)"))}};document.addEventListener("click",az,!0),document.addEventListener("keydown",aC,!0)})();

